{
  "name": "Tool - Pega_Metricas_Meta_ads",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.chatInput }}",
        "options": {
          "systemMessage": "=<name>\nM√©tricas da Meta por Per√≠odo\n</name>\n<description>\nGera relat√≥rios de an√∫ncios do Meta Ads com base em um per√≠odo solicitado pelo usu√°rio.\n</description>\n<role>\nSou um especialista em m√©tricas de tr√°fego pago, com foco em campanhas do Meta Ads.\n</role>\n<goal>\nGerar um relat√≥rio de desempenho com base no per√≠odo solicitado pelo usu√°rio e no per√≠odo anterior equivalente.\n</goal>\n<instructions>\n- Voc√™ DEVE falar de forma clara e evitar jarg√µes.\n- Sempre que um usu√°rio solicitar um per√≠odo (ex: \"hoje\", \"essa semana\"), gere o relat√≥rio do *per√≠odo atual solicitado* E tamb√©m do *per√≠odo imediatamente anterior equivalente*.\n  Exemplo:\n  Usu√°rio: \"quero saber como foi hoje\"  \n  Voc√™: gera o relat√≥rio de hoje e de ontem, e apresenta ambos com as datas como \"Per√≠odo Atual\" e \"Per√≠odo Anterior\".\n- S√≥ inicie a execu√ß√£o se os seguintes dados obrigat√≥rios estiverem presentes:\n  1. `data para gerar o relat√≥rio`\n  2. `cliente` (para saber de qual conta puxar os dados)\n  3. `filtro por nome da campanha` (se aplic√°vel - pergunte se deseja filtrar por algum nome espec√≠fico ou se ser√° um relat√≥rio geral)\n- **CAMPOS ESPEC√çFICOS PARA M√âTRICAS:**\n  - Para relat√≥rios de **mensagens ou conversas**: sempre use o campo `onsite_conversion.messaging_welcome_message_view`\n  - Para relat√≥rios de **compras**: sempre use o campo `purchase`\n- A estrutura do relat√≥rio deve seguir exatamente esta ordem:\n  1. T√≠tulo: *Relat√≥rio de Desempenho Meta Ads*\n  2. üëâPer√≠odo Atual: [data formatada]\n  3. M√©tricas: Impress√µes, Alcance, Cliques, Gasto\n  4. A√ß√µes: Compras em loja, Adi√ß√µes ao carrinho, Inicia√ß√£o de checkout, Engajamentos na p√°gina, Visualiza√ß√µes de landing page\n  5. üëâPer√≠odo Anterior: [data formatada]\n  6. As mesmas m√©tricas e a√ß√µes, na mesma ordem\n- IMPORTANTE: Nunca omita m√©tricas. Caso algum campo (como \"Compras\", \"Cliques\", \"Visualiza√ß√µes de p√°gina\", etc.) n√£o esteja presente nos dados retornados, voc√™ DEVE preencher com o valor `0`.\n- Isso garante que a estrutura do relat√≥rio seja sempre id√™ntica para o per√≠odo atual e o anterior, mesmo quando houver aus√™ncia de dados.\n- A data de hoje √©: {{ $now }}\n- Sempre envie os inputs no formato de texto plano (string), mesmo que esteja lidando com dados estruturados. Converta objetos em string se necess√°rio.\n</instructions>"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        -200,
        0
      ],
      "id": "d31c2816-cf38-4581-81d2-55148b713648",
      "name": "Pega_M√©tricas_Meta_ads"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.sessionId }}",
        "contextWindowLength": 0
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -420,
        260
      ],
      "id": "f4c3d53a-f3bb-4679-a329-ca0ad009141e",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "toolDescription": "Use essa tool para recuperar m√©tricas sem filtrar por campanhas. essa tool funciona no n√≠vel de Conta na meta.",
        "url": "=https://graph.facebook.com/v20.0/act_{{ $fromAI('act_id','id da conta de an√∫ncios da meta')}}/insights",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "fields",
              "value": "impressions,reach,clicks,spend,actions,action_values"
            },
            {
              "name": "time_range",
              "value": "={\"since\":\"{{ $fromAI('data_inicial','dada inicial para filtrar m√©tricas no formato yyyy-mm-dd') }}\",\"until\":\"{{ $fromAI('data_final','dada final para filtrar m√©tricas no formato yyyy-mm-dd') }}\"} "
            },
            {
              "name": "level",
              "value": "account"
            },
            {
              "name": "limit",
              "value": "1000"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        -100,
        260
      ],
      "id": "4b73cbfa-18f1-48a4-bf5a-dd8308f9323c",
      "name": "Metricas_periodo_metaads",
      "credentials": {
        "httpQueryAuth": {
          "id": "6XQ4500JHGgJdUgG",
          "name": "meta ads"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -580,
        260
      ],
      "id": "b835b267-a47f-4ca1-a777-db7bafdfda26",
      "name": "GPT 4o mini",
      "credentials": {
        "openAiApi": {
          "id": "WU3EiAv2SKvrX4S2",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "sessionId"
            },
            {
              "name": "chatInput"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -540,
        -200
      ],
      "id": "9b3eb01f-ffe0-4aab-902e-3a492c71a269",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "public": true,
        "mode": "webhook",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -540,
        0
      ],
      "id": "747a43f4-2e71-4aaf-afef-846de02bd8fa",
      "name": "When chat message received",
      "webhookId": "c411ad44-e098-405f-95d7-683672391dd8"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1LEwb41Vh2-eBvwp9FJ4qWKZ06UQGdS9ApYBCSRY_A7k",
          "mode": "list",
          "cachedResultName": "Planilha Base - Tr√°fego com IA",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LEwb41Vh2-eBvwp9FJ4qWKZ06UQGdS9ApYBCSRY_A7k/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Preencha - Relat√≥rios",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LEwb41Vh2-eBvwp9FJ4qWKZ06UQGdS9ApYBCSRY_A7k/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.5,
      "position": [
        -260,
        260
      ],
      "id": "64b998e8-d7c2-45bb-aa24-9947c05215e1",
      "name": "Pega_dados_cliente",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "buEdkadAbrGmkuYR",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Use essa tool para recuperar m√©tricas sem filtrar por campanhas. essa tool funciona no n√≠vel de Conta na meta.",
        "url": "=https://graph.facebook.com/v20.0/act_{{ $fromAI('act_id','id da conta de an√∫ncios da meta')}}/insights",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "fields",
              "value": "campaign_name,impressions,reach,clicks,spend,actions,action_values"
            },
            {
              "name": "time_range",
              "value": "={\"since\":\"{{ $fromAI('data_inicial','dada inicial para filtrar m√©tricas no formato yyyy-mm-dd') }}\",\"until\":\"{{ $fromAI('data_final','dada final para filtrar m√©tricas no formato yyyy-mm-dd') }}\"} "
            },
            {
              "name": "level",
              "value": "campaign"
            },
            {
              "name": "limit",
              "value": "2000"
            },
            {
              "name": "filtering",
              "value": "=[{\"field\":\"campaign.name\",\"operator\":\"CONTAIN\",\"value\":\"{{ $fromAI('nome_campanha','nome da campanha para fazer o filtro')}}\"}]"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        80,
        260
      ],
      "id": "3946a06f-0d15-4f0a-bbd9-0cf532b09b54",
      "name": "Metricas_periodo_metaads_pelo_nome_campanha",
      "credentials": {
        "httpQueryAuth": {
          "id": "6XQ4500JHGgJdUgG",
          "name": "meta ads"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "Pega_M√©tricas_Meta_ads",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Metricas_periodo_metaads": {
      "ai_tool": [
        [
          {
            "node": "Pega_M√©tricas_Meta_ads",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "GPT 4o mini": {
      "ai_languageModel": [
        [
          {
            "node": "Pega_M√©tricas_Meta_ads",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Pega_M√©tricas_Meta_ads",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Pega_M√©tricas_Meta_ads",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pega_dados_cliente": {
      "ai_tool": [
        [
          {
            "node": "Pega_M√©tricas_Meta_ads",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Metricas_periodo_metaads_pelo_nome_campanha": {
      "ai_tool": [
        [
          {
            "node": "Pega_M√©tricas_Meta_ads",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "7e8d7950-3ce1-4eca-9fd4-543ef9dca21c",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "b7e371dcb80c55249518de3a5a10d12d5b6cff193a6bfc61b376d41d11424c37"
  },
  "id": "5qgrngIoX7HxmucT",
  "tags": []
}