{
  "name": "Tool - top_criativos",
  "nodes": [
    {
      "parameters": {
        "toolDescription": "Use essa tool para recuperar m√©tricas sem filtrar por Criativos. essa tool funciona no n√≠vel de an√∫ncios 'ad'.",
        "url": "=https://graph.facebook.com/v20.0/act_{{ $fromAI('act_id','id da conta de an√∫ncios da meta')}}/insights",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "fields",
              "value": "spend,ad_name,ad_id"
            },
            {
              "name": "time_range",
              "value": "={\"since\":\"{{ $fromAI('data_inicial','dada inicial para filtrar m√©tricas no formato yyyy-mm-dd') }}\",\"until\":\"{{ $fromAI('data_final','dada final para filtrar m√©tricas no formato yyyy-mm-dd') }}\"} "
            },
            {
              "name": "level",
              "value": "ad"
            },
            {
              "name": "limit",
              "value": "1000"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        200,
        -80
      ],
      "id": "60109afc-89cc-4d3c-a7fb-a5d435ecfddc",
      "name": "Metricas_criativos_periodo_metaads",
      "credentials": {
        "httpQueryAuth": {
          "id": "6XQ4500JHGgJdUgG",
          "name": "meta ads"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Use essa tool para pegar o ad creative do an√∫ncio/ad",
        "url": "=https://graph.facebook.com/v22.0/{{ $fromAI('ad_id','id do anuncio para pegar o ad creative') }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "fields",
              "value": "creative"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        360,
        -80
      ],
      "id": "302d1263-5325-42c0-972d-1c3524554615",
      "name": "pega_ad_creative",
      "credentials": {
        "httpQueryAuth": {
          "id": "6XQ4500JHGgJdUgG",
          "name": "meta ads"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.chatInput }}",
        "options": {
          "systemMessage": "=<name>\nTop Criativos de An√∫ncios\n</name>\n\n<description>\nIdentifica os criativos com maior desempenho com base nos an√∫ncios que mais gastaram, unifica suas varia√ß√µes e retorna os dados consolidados com link e total de convers√µes.\n</description>\n\n<role>\nSou um analista de desempenho criativo. Recebo uma lista de an√∫ncios, identifico os que mais gastaram, agrupo varia√ß√µes do mesmo criativo, busco o link do an√∫ncio e apresento os melhores com o total de convers√µes unificadas.\n</role>\n\n<goal>\nListar os principais criativos com base nos an√∫ncios de maior gasto, unificando nomes semelhantes e somando as convers√µes, retornando nome, link e total de convers√µes para cada um.\n</goal>\n\n<instructions>\n- Voc√™ receber√° uma lista de an√∫ncios com pelo menos: nome, ID e valor gasto (spend).\n- Liste os an√∫ncios em ordem decrescente de *gasto total*.\n- Para cada criativo, identifique varia√ß√µes do mesmo nome. Considere que nomes como:\n  - `AD01`, `AD01 - c√≥pia`, `AD01.mp4`, `ad01` representam o mesmo criativo.\n  - Normalize os nomes (remova espa√ßos, \".mp4\", acentos, letras mai√∫sculas) para unifica√ß√£o.\n\n- Para cada grupo de varia√ß√µes:\n  - Escolha o an√∫ncio com MAIOR gasto como refer√™ncia.\n  - Use o `ID` desse an√∫ncio como base para a ferramenta `pega_ad_creative`.\n\n- Para cada ad creative obtido:\n  - Use a ferramenta `pega_url_anuncio` passando o ad creative para obter o link do an√∫ncio.\n\n- Em seguida, use a ferramenta `metrics_by_name_ad`, passando o *nome normalizado do criativo*.\n  - Essa ferramenta ir√° retornar todas as varia√ß√µes daquele criativo.\n  - Some o total de convers√µes entre todas as varia√ß√µes encontradas.\n  - O tipo de convers√£o (compra, lead ou outro) depende do objetivo principal da campanha.\n\n- Ap√≥s reunir os dados de todos os criativos:\n  - Monte a lista final no seguinte formato, ordenada por n√∫mero de convers√µes (do maior para o menor):\n\nTOP X criativos üëá  \n*nome:* [nome do criativo com maior gasto]  \n*link:* [link do an√∫ncio]  \n*convers√µes:* [soma total das convers√µes das varia√ß√µes]\n\n- A quantidade de criativos exibida deve respeitar o n√∫mero solicitado pelo usu√°rio (ex: \"top 10\").\n\n- Se algum campo n√£o for encontrado (como o link ou o total de convers√µes), preencha com `N/A`, mas n√£o exclua o item da lista.\n\n- A resposta deve conter apenas a lista, sem explica√ß√µes, an√°lises ou coment√°rios adicionais.\n\n- Mantenha o formato compat√≠vel com envio via WhatsApp.\n\n- A data de hoje √©: {{ $now }}\n\n- Sempre envie os inputs no formato de texto plano (string), mesmo que esteja lidando com dados estruturados. Converta objetos em string se necess√°rio.\n\n</instructions>\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        20,
        -300
      ],
      "id": "d8dd01bd-1f67-4aa6-b4ec-10fabbf34a72",
      "name": "top_criativos"
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v22.0/act_{{ $fromAI('act_id','id da conta de an√∫ncios da meta')}}/insights",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "fields",
              "value": "ad_name,ad_id,spend,actions"
            },
            {
              "name": "level",
              "value": "ad"
            },
            {
              "name": "filtering",
              "value": "=[{'field':'ad.name','operator':'CONTAIN','value':'{{ $fromAI('name_ad','nome do an√∫ncio que precisa filtrar')}}'}]"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        520,
        -80
      ],
      "id": "e2e16e61-4da2-4097-b190-d62b3f4e97c7",
      "name": "metrics_by_name_ad",
      "credentials": {
        "httpQueryAuth": {
          "id": "6XQ4500JHGgJdUgG",
          "name": "meta ads"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "gpt-4o"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -440,
        -80
      ],
      "id": "8666f6eb-c835-4099-91d3-76065c4c9224",
      "name": "GPT 4o",
      "credentials": {
        "openAiApi": {
          "id": "WU3EiAv2SKvrX4S2",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1,
      "position": [
        680,
        -80
      ],
      "id": "50bf5a40-1363-4722-92df-296f0eb71ab0",
      "name": "Think"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.sessionId }}",
        "contextWindowLength": 0
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -280,
        -80
      ],
      "id": "adf26847-97ec-4eb8-a6a5-61a5918546fa",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "sessionId"
            },
            {
              "name": "chatInput"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -640,
        -400
      ],
      "id": "d2540911-2be3-42bb-b0b4-f90434a9deda",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "public": true,
        "mode": "webhook",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -640,
        -200
      ],
      "id": "82a1089b-a603-449e-990a-022a026f32f9",
      "name": "When chat message received",
      "webhookId": "d04b12aa-5b42-49cc-a21a-f620cd5e270d"
    },
    {
      "parameters": {
        "toolDescription": "Use essa tool ap√≥s ter o ad creative dos an√∫ncios para pegar a url de cada um deles.",
        "url": "=https://graph.facebook.com/v22.0/{{ $fromAI('creative_id','√© diferente do ad id. √© o creative id') }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "fields",
              "value": "instagram_permalink_url"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        40,
        -80
      ],
      "id": "87404dfc-0968-4f63-b3a2-5decc784b5bf",
      "name": "Pega _URL_anuncio",
      "credentials": {
        "httpQueryAuth": {
          "id": "6XQ4500JHGgJdUgG",
          "name": "meta ads"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1LEwb41Vh2-eBvwp9FJ4qWKZ06UQGdS9ApYBCSRY_A7k",
          "mode": "list",
          "cachedResultName": "Planilha Base - Tr√°fego com IA",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LEwb41Vh2-eBvwp9FJ4qWKZ06UQGdS9ApYBCSRY_A7k/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Preencha - Relat√≥rios",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LEwb41Vh2-eBvwp9FJ4qWKZ06UQGdS9ApYBCSRY_A7k/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.5,
      "position": [
        -120,
        -80
      ],
      "id": "b1119cbb-42a4-4c14-bac7-86e130ad35c4",
      "name": "Pega_dados_cliente",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "buEdkadAbrGmkuYR",
          "name": "Google Sheets account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Metricas_criativos_periodo_metaads": {
      "ai_tool": [
        [
          {
            "node": "top_criativos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "pega_ad_creative": {
      "ai_tool": [
        [
          {
            "node": "top_criativos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "metrics_by_name_ad": {
      "ai_tool": [
        [
          {
            "node": "top_criativos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "GPT 4o": {
      "ai_languageModel": [
        [
          {
            "node": "top_criativos",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Think": {
      "ai_tool": [
        [
          {
            "node": "top_criativos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "top_criativos",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "top_criativos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "top_criativos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pega _URL_anuncio": {
      "ai_tool": [
        [
          {
            "node": "top_criativos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Pega_dados_cliente": {
      "ai_tool": [
        [
          {
            "node": "top_criativos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "585a3622-3d10-4fb3-9f78-2deef81e33df",
  "meta": {
    "instanceId": "b7e371dcb80c55249518de3a5a10d12d5b6cff193a6bfc61b376d41d11424c37"
  },
  "id": "5Y9i7PXCbsYxrGi8",
  "tags": []
}